<!doctype html>
<head>
<title>OpenBCI Hub Home</title>
<style>
	.start_stream {
		background-color: 'green';
	}
	.stop_stream {
		background-color: 'red';
	}
</style>
</head>
<body>
	<button class="btn">Stream</button>
  <h1> {{ status }}!</h1>
<script src="https://code.jquery.com/jquery-2.1.3.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>
<script src="http://smoothiecharts.org/smoothie.js"></script>
<script type="text/javascript" charset="utf-8">
	function Timeline() {
	  this.data = new TimeSeries();
	  this.chart = new SmoothieChart();
	  this.chart.addTimeSeries(this.data, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 1 });
	  var chartEl = document.createElement("CANVAS");
	  chartEl.setAttribute("width", "400");
	  chartEl.setAttribute("height", "200");
	  this.chart.streamTo(chartEl, 500);
	  document.body.appendChild(chartEl);
	}

	Timeline.prototype.sample = function (s) {
	  this.data.append(new Date().getTime(), s);
	}


	var waves = [];
	for (var i = 0; i < 8; i++) {
	  waves.push(new Timeline());
	}

	var process = 1;

  var socket = io.connect('http://' + document.domain + ':' + location.port + '/test');
  console.log('domain', document.domain, ':', location.port);
  socket.on('connect', function() {
  		console.log('connected');
      socket.emit('test event', {data: 'I\'m connected!'});
  });
  socket.on('stream', function (stream){
  	console.log('recieved message');
  	// console.log(stream.data);

	  if (process % 3 == 0) {
	    for (var i = 0; i < 8; i++) {
	        waves[i].sample(stream.data[i]);
	    }
	    process = 1;
	  }
	  process++;
  });
</script>
<script>
	$('.btn').click(function() {
		console.log('button clicked');
		$.ajax({
		   type: "POST",
		   url: 'http://localhost:5000/startstop'
		})
			.done(function (data) {
				console.log(data);
			});
		$('.btn').toggleClass('stream');
	})


$(document).ready(function() {
		console.log('button clicked');
		$.ajax({
		   url: 'http://localhost:5000/startstop'
		})
			.done(function (data) {
				console.log(data);
			});
		$('.btn').toggleClass('stream');
	});
</script>
</body>
